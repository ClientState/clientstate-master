nginx:
  # volumes with vagrant are wtf.
  # so, we add the confs in the dockerfile
  environment:
    CSM_SERVER_NAME:
  build: ./docker/nginx/
  ports:
    - "80:80"
    - "443:443"
  links:
    - csm
    - redis

csm:
  build: .
  environment:
    GITHUB_CLIENT_ID:
    GITHUB_CLIENT_SECRET:
    OAUTH_REDIRECT_URL:
    PG_USER: postgres
    DOCKER_PARENT_HOST:
    DOCKER_PARENT_PORT:
  command: node server.js
  ports:
    - "4000:4000"
  links:
    - pg
    - redis

pg:
  image: postgres

pgdata:
  image: busybox
  volumes_from:
    - pg

redis:
  image: redis

redisdata:
  image: busybox
  volumes_from:
    - redis
